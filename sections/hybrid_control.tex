\section{Hybrid Control System}

This year's hybrid control system is a completely new project for avionics with no prior system to inform its design.
The current working prototype is an Arduino based control system which has been difficult to maintain and use. The
system was designed using breadboard electronics and it is very difficult to organize the jumper wires or perform
repairs on the system. It also does not have the ability to detect connection interruptions, the user interface does not
update at the speed desired for monitoring the system and it has a tendency to crash spuriously. This prototype system
has sufficed for preliminary testing of the hybrid in cold flows, but must be updated for static fire testing and
launch.

\subsection{Network Infrastructure}

Given that the launch pad and control base are separated by several hundred meters, it will be infeasible to establish 
a wired connection between the two. For this reason, communication between the launch pad and the control base will be
carried out over wireless ethernet using two Ubiquiti Litebeam M5 wireless network bridges. These network bridges will connect 
the \glsxtrfull{lan} at the control base and the \glsxtrshort{lan} at the launch pad, allowing them to communicate as if they 
were in the same LAN.

Each Litebeam M5 is powered using a 24V, 0.2A power over ethernet (PoE) adapter. <talk about specs>. 

Two types of communication will be handled over the network. The first is telemetry data sent from the launch pad which will be 
received by a telemetry client at the control base. Telemetry data will be transmitted from the launch pad to a \glsxtrfull{udp}
multicast group which the telemetry client will join. While transmitting data to a \glsxtrshort{udp} multicast address may be 
slightly slower than traditional \glsxtrshort{udp} unicast communication which transmits to a single device, transmitting to a 
multicast address provides redundancy in the sense that multiple clients are able to receive the same data should any single client
fail.

The second type of communication to be transmitted is control packets

\subsection{Control System Nodes}

The communication within the hybrid control system network is centered around three distinct node types:

\begin{itemize}
    \item Telemetry clients
    \item Control client
    \item Pad control server
\end{itemize}

\subsubsection{Telemetry Clients}

Telemetry clients are simply consumers of the telemetry data produced by the pad control server. There can be a
theoretically infinite number of telemetry clients on the network at once, and they can all consume the same data being
sent by the pad control server. This is possible through the use of UDP multicast.

Telemetry clients are free to do whatever they would like with the telemetry data they receive. This could be simply
logging it to a file, performing a statistical analysis or using it to update status LEDs/hardware on a physical device.
The hybrid control UI is an example of a telemetry client which displays the data it receives visually.

\subsubsection{Control Client}

A control client is able to issue commands to the pad server. Only one control client is permitted to be connected to
the pad server at once. This is done to prevent the receipt of conflicting commands from two controllers, eliminating a
large suite of possible race conditions.

The commands sent from a control client are either arming commands or commands for actuating (turning on or off)
actuators. Control clients are simple in that they only send these commands to the pad server and wait for a response
indicating success or failure of the command. Control clients \textbf{do not} maintain any state about the actuators
they control, they only blindly issue commands and receive indication of success or failure. In this way, all state is
maintained on the pad server which preserves a single source of truth in the system. This makes it impossible for the
control client to get out of sync with the real system state.

\subsubsection{Pad Server}

The pad server is the most complicated of the nodes. The pad server produces all the telemetry data from the system
sensors, which it sends over \gls{udp} multicast. This design allows a theoretically infinite number of telemetry
clients to consume telemetry data, while the server only has to perform a single "send" operation.

The pad server simultaneously handles incoming commands from the control client, to which it responds with a success or
failure acknowledgement. The pad server is responsible for maintaining internal state about the actuators and current
arming level, which it uses to decide whether the command is currently possible. For example, a command to ignite the
igniter is not allowed until the main valve for the oxidizer has been opened, and that itself depends on a sequence of
prior conditions. There is a progression of arming escalation which must be adhered to.

Responding to commands from the control client is prioritized above telemetry. At the top priority is the emergency
abort sequence for dumping the oxidizer in the tank when pressure spikes above nominal levels are detected, or when
network connection has been lost for a predefined time duration.

\subsubsection{Combination Nodes}

Combination nodes are those nodes which implement both the control client and telemetry client nodes on one system. This
may useful for a control box with a heads up display for telemetry readings, which the operator may need to use to
inform command decisions. These systems can use telemetry data to inform sending commands, etc. but should still never
store any state about the system. All state information can be queried from the pad server.

\subsection{Hardware Design}
